# 更新日志

## [1.2.0] - 2026-01-29

### 新增

- ✨ **图片下载功能**：自动下载文章中的所有图片到本地
- ✨ **智能图片筛选**：自动过滤小于指定大小的装饰性图片（默认 < 15KB）
- ✨ **图片位置保持**：使用占位符机制，保留图片在原文档中的位置
- ✨ **自动文件命名**：根据文章标题自动生成 Markdown 文件名和资源文件夹名
- ✨ **资源文件夹**：图片保存到 `{文件名}_assets` 文件夹中

### 改进

- 🔧 **图片引用格式**：在 Markdown 中使用 `![alt](path)` 格式引用本地图片
- 🔧 **筛选配置**：支持自定义文件大小阈值和启用/禁用筛选
- 🔧 **占位符清理**：被过滤的图片占位符自动移除，不显示错误提示
- 🔧 **下载进度显示**：显示图片下载进度和筛选统计信息

### 技术细节

- 新增 `downloadImage()` 函数：下载单个图片，支持重定向和超时处理
- 新增 `downloadImages()` 函数：批量下载图片，支持文件大小筛选
- 新增 `IMAGE_FILTER_CONFIG` 配置对象：控制筛选行为
- 改进 `saveAsMarkdown()` 函数：下载图片并替换占位符为 Markdown 图片引用
- 图片命名使用时间戳和索引，避免重名冲突

### 使用示例

```bash
# 保存文章并自动下载图片
node fetch.js "文章URL" "/path/to/directory/"

# 生成的文件结构：
# ├── 文章标题.md
# └── 文章标题_assets/
#     ├── image_xxx_0.jpg
#     └── image_xxx_1.jpg
```

---

## [1.1.0] - 2026-01-22

### 新增

- ✨ 智能工作流说明：检测法律内容时自动调用 `legal-text-format`
- ✨ "与其他技能的协作"章节，说明智能判断逻辑
- ✨ 法律内容检测特征说明（标题关键词、内容特征、结构特征）
- ✨ 默认保存位置说明（项目根目录）

### 改进

- 📝 完善技能文档，明确工作流程和协作方式
- 🔧 保持工具通用性：仅 AI 智能判断为法律内容时才调用格式化
- 🔧 添加保存位置示例，说明不同路径的处理方式
- 🔧 明确工具定位：专注于文章抓取，格式化由专门的 skill 处理

### 技术细节

- 智能判断基于：标题关键词、内容特征、结构特征
- 支持法律内容自动触发格式化工作流
- 非法律内容保持原有抓取功能

---

## [1.0.0] - 2026-01-21

### 新增

- ✨ 自动保存为 Markdown 文件功能，支持指定文件路径或目录
- ✨ 智能回退机制：无头模式失败时自动切换到有头模式重试
- ✨ 完整的 Windows 平台支持

### 修复

- 🐛 修复 Windows 平台上 npx 命令执行问题
- 🐛 修复 ES 模块路径检测在 Windows 上的兼容性问题
- 🐛 修复路径分隔符在 Windows 上的处理问题
- 🐛 修复文件名包含 Windows 非法字符时的保存问题

### 改进

- 📝 更新技能文档，添加详细的使用示例
- 🔧 增强错误处理，提供更清晰的错误提示
- 🔧 优化命令行参数处理，支持可选的输出路径

### 技术细节

- 添加 `getNpxCommand()` 函数，根据平台自动选择正确的命令格式
- 实现 `isMainModuleCheck()` 函数，使用路径规范化处理跨平台兼容性
- 实现 `saveAsMarkdown()` 函数，自动处理文件名和目录创建
- 增强 `fetchWechatArticle()` 函数，支持可选的自动保存参数

---

## [0.1.1] - 2025-01-13

### 新增

- 完善技能文件结构，符合 legal-skills 项目规范
- 添加 `.claude-plugin/plugin.json` 元数据文件
- 添加 `package.json` 支持 npm 模块化
- 添加 `LICENSE` (MIT) 许可证文件
- 创建 `archive/` 目录结构

### 修复

- 修复主模块检测条件，支持带空格路径的脚本执行
- 修复 Playwright API 兼容性问题，使用 newContext 替代直接 setUserAgent
- 更新到最新的 Playwright API (v1.40+)

### 测试

- 完成实际微信公众号文章抓取测试
- 验证所有功能正常运行

### 待办事项

- [ ] 添加批量抓取功能
- [x] 支持保存抓取结果到文件（已在 v1.0.0 实现）
- [ ] 添加单元测试
- [ ] 优化错误页面检测逻辑

---

## [0.1.0] - 2025-01-13

### 新增

- 实现微信公众号文章抓取功能
- 支持 Playwright headless 模式抓取
- 自动检测并安装 Playwright 依赖
- 支持自动重试机制(最多3次)
- 反检测设置,避免被反爬虫机制识别
- 动态加载懒加载内容
- 提取文章标题和正文内容
- 返回纯文本格式,便于后续处理

### 技术优化

- 使用 ES6+ 模块化语法
- 完善的错误处理和重试逻辑
- 自动安装浏览器依赖
- 优化的 User-Agent 和视口设置
